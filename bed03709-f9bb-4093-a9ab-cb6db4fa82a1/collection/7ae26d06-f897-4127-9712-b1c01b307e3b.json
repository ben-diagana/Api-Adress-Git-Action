{"info":{"_postman_id":"7ae26d06-f897-4127-9712-b1c01b307e3b","name":"Creation produit cityzen","schema":"https://schema.getpostman.com/json/collection/v2.1.0/collection.json"},"item":[{"name":"Create Cityzen","event":[{"listen":"test","script":{"id":"beb19178-6017-46c0-91fd-ace239a6efd1","exec":["pm.test(\"Status code is 201\", function () {","    console.log(pm.request)","    pm.response.to.have.status(201);","});"],"type":"text/javascript"}},{"listen":"prerequest","script":{"id":"2dad0039-a619-4116-9963-fd31efd4bda6","exec":["let date = Date.now()\r","let email = \"cityzen\" + date + \"@mvms.fr\"\r","pm.environment.set('CityzenEmail', email)"],"type":"text/javascript"}}],"id":"f9a5af5c-5330-4a18-aa78-45697dbe8d07","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"apikey","apikey":[{"key":"value","value":"{{ApiKey}}","type":"string"},{"key":"key","value":"autorization","type":"string"},{"key":"in","value":"header","type":"string"}]},"method":"POST","header":[],"body":{"mode":"raw","raw":"{\n  \"email\": \"{{CityzenEmail}}\",\n  \"password\": \"Ben@194561\",\n  \"nickname\": \"Heisenberg\",\n  \"firstName\" : \"Jess\",\n  \"lastName\": \"Pikman\",\n  \"cityletterAcceptance\": 0,\n  \"policyRulePrivacyTerms\": true,\n  \"type\": \"customer\"\n}","options":{"raw":{"language":"json"}}},"url":{"raw":"{{BaseUrl}}/{{UserSlug}}/api/v1/users","host":["{{BaseUrl}}"],"path":["{{UserSlug}}","api","v1","users"]}},"response":[]},{"name":"Sign in","event":[{"listen":"test","script":{"id":"52e1e468-2c5c-4a11-838e-1209e5f98f63","exec":["let responseData = pm.response.json();","pm.environment.set(\"authToken\", responseData.authToken);","console.log(\"Login done with token:\", pm.environment.get(\"authToken\"));","pm.test(\"Valid response\", function () {","    pm.response.to.have.status(201);","});"],"type":"text/javascript"}}],"id":"694f9cc4-dae1-4f8c-907f-f91f632844ec","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"apikey","apikey":[{"key":"value","value":"{{ApiKey}}","type":"string"},{"key":"key","value":"autorization","type":"string"}]},"method":"POST","header":[],"body":{"mode":"raw","raw":"{\n    \"email\": \"{{UserEmail}}\",\n    \"password\": \"{{UserPassword}}\"\n}","options":{"raw":{"language":"json"}}},"url":{"raw":"{{BaseUrl}}/{{UserSlug}}/api/v1/users/sign_in","host":["{{BaseUrl}}"],"path":["{{UserSlug}}","api","v1","users","sign_in"]}},"response":[]},{"name":"Retrieve citizen's informations of a user","event":[{"listen":"test","script":{"id":"46a6e33b-9fac-4af1-8b7e-9da24bde7919","exec":["pm.test(\"Status code is 200\", function () {","    pm.response.to.have.status(200);","});","","let cityzenId = pm.response.json().id;","pm.environment.set(\"cityzenId\", cityzenId);"],"type":"text/javascript"}}],"id":"b41a072c-80d5-47da-8b3f-4092ba9a3f89","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"apikey","apikey":[{"key":"value","value":"{{ApiKey}}","type":"string"},{"key":"key","value":"autorization","type":"string"}]},"method":"GET","header":[{"key":"x-client-id","value":"{{authToken}}","type":"default"}],"url":{"raw":"{{BaseUrl}}/{{UserSlug}}/api/v1/auth/users/self/citizen","host":["{{BaseUrl}}"],"path":["{{UserSlug}}","api","v1","auth","users","self","citizen"]}},"response":[]},{"name":"Get cityzen products","event":[{"listen":"prerequest","script":{"id":"9e119ea5-d6e8-4679-9e5a-e3ca989c633d","exec":["let cityzenId = pm.environment.get(\"cityzenId\");"],"type":"text/javascript"}},{"listen":"test","script":{"id":"c863b4f6-a7a7-4fc1-abf4-41c001982350","exec":["pm.test(\"Status code is 200\", function () {","    pm.response.to.have.status(200);","});","","let responseData = pm.response.json();","let products = responseData.products;","let createdProduct = products[0];","let createdProductId = createdProduct.id;","let variantId = createdProduct.variants[0].id;","pm.environment.set(\"productId\", createdProductId);","pm.environment.set(\"variantId\", variantId);","","","console.log(\"Created with productId: \", createdProductId, \" and variantId \", variantId);","","pm.test(\"Product should be in submitted status\", function(){","    pm.expect(createdProduct.status).to.eql(\"submitted\");","});"],"type":"text/javascript"}}],"id":"c5e7481c-40c9-4abe-ae91-79dba4b1a8bd","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{apiKey}}","type":"string"}]},"method":"GET","header":[],"url":{"raw":"{{baseUrl}}catalog-dev/api/v1/citizens/{{cityzenId}}/products","host":["{{baseUrl}}catalog-dev"],"path":["api","v1","citizens","{{cityzenId}}","products"]}},"response":[]},{"name":"Update product variant","event":[{"listen":"prerequest","script":{"exec":["let variantId = pm.environment.get(\"variantId\");","let authToken = pm.environment.get(\"authToken\");","","console.log(\"AuthToken\", authToken);","console.log(\"variantId\", variantId);"],"type":"text/javascript","id":"11a36ef9-dbcf-43ce-adcc-bd03dcd9a910"}},{"listen":"test","script":{"exec":["pm.test(\"Status code is 200\", function () {","    pm.response.to.have.status(200);","});"],"type":"text/javascript","id":"daae0bc9-b693-4e8d-aaca-339d11a295d7"}}],"id":"e48b35eb-3830-4b2b-a772-056e7d0f4ef4","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{apiKey}}","type":"string"}]},"method":"PATCH","header":[{"key":"x-client-id","value":"{{authToken}}","type":"default"}],"body":{"mode":"formdata","formdata":[{"key":"basePrice","value":"9999","type":"default"}]},"url":{"raw":"{{baseUrl}}catalog-dev/api/v1/auth/variants/{{variantId}}","host":["{{baseUrl}}catalog-dev"],"path":["api","v1","auth","variants","{{variantId}}"]}},"response":[]},{"name":"Get Product after variant update","event":[{"listen":"prerequest","script":{"exec":["let productId = pm.environment.get(\"productId\");","let authToken = pm.environment.get(\"authToken\");",""],"type":"text/javascript","id":"75c0577f-5223-4375-a5b1-f20a7c0d0a9c"}},{"listen":"test","script":{"exec":["pm.test(\"Status code is 200\", function () {","    pm.response.to.have.status(200);","});","","pm.test(\"Product status should be submitted\", function(){","    let responseData = pm.response.json();","    pm.expect(responseData.status).to.eql(\"submitted\");","});"],"type":"text/javascript","id":"877937f4-7336-4556-a684-6e839de56d9f"}}],"id":"7a4458d1-45e2-465e-b55a-80cf6db4a9eb","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{apiKey}}","type":"string"}]},"method":"GET","header":[{"key":"x-client-id","value":"{{authToken}}","type":"default"}],"url":{"raw":"{{baseUrl}}/catalog-dev/api/v1/products/{{productId}}","host":["{{baseUrl}}"],"path":["catalog-dev","api","v1","products","{{productId}}"]}},"response":[]},{"name":"Update product","id":"c11d43ee-a4d9-4d32-8dd0-b03cb3541400","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"GET","header":[],"url":{"raw":""}},"response":[]},{"name":"Delete product","event":[{"listen":"prerequest","script":{"exec":["let productId = pm.environment.get(\"productId\");","let authToken = pm.environment.get(\"authToken\");","","console.log(\"Will delete product\", productId);"],"type":"text/javascript","id":"0b454f9f-f28e-4bb0-9e1e-72da5f72f099"}},{"listen":"test","script":{"exec":["pm.test(\"Status code is 204\", function () {","    pm.response.to.have.status(204);","});"],"type":"text/javascript","id":"071fcd4e-81e8-4eb3-a07e-3962eae6c1b4"}}],"id":"2b14ccfa-3b6e-496e-8f17-66c610596743","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{apiKey}}","type":"string"}]},"method":"DELETE","header":[{"key":"x-client-id","value":"{{authToken}}","type":"default"}],"url":{"raw":"{{baseUrl}}{{deleteProductRoute}}/{{productId}}","host":["{{baseUrl}}{{deleteProductRoute}}"],"path":["{{productId}}"]}},"response":[]},{"name":"Delete Cityzen","event":[{"listen":"prerequest","script":{"exec":["let authToken = pm.environment.get(\"authToken\");","console.log(\"AuthToken:\", authToken);"],"type":"text/javascript","id":"237946ac-4c49-4246-beef-cd8a2214e2e0"}},{"listen":"test","script":{"exec":["pm.test(\"Status code is 204\", function () {","    pm.response.to.have.status(204);","});"],"type":"text/javascript","id":"970acd2e-67f7-4733-be30-9b2657c7c1b2"}}],"id":"996b92c9-4f06-4751-9f1a-bcac56830de8","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{apiKey}}","type":"string"}]},"method":"DELETE","header":[{"key":"x-client-id","value":"{{authToken}}","type":"default"},{"key":"x-client-id","value":"eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MTMxNTUsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwiZXhwIjoxNjYyMTA2ODM0fQ.sUr6sRNgVacU2etExIJhstSYITpbn4AVztXmcwaENk0","type":"default","disabled":true}],"url":{"raw":"{{baseUrl}}{{deleteCityzenRoute}}","host":["{{baseUrl}}{{deleteCityzenRoute}}"]}},"response":[]}],"auth":{"type":"bearer","bearer":[{"key":"token","value":"{{apiKey}}","type":"string"}]},"event":[{"listen":"prerequest","script":{"type":"text/javascript","exec":[""],"id":"8b3ae43f-c3df-429e-9d37-ca3e8c241f40"}},{"listen":"test","script":{"type":"text/javascript","exec":[""],"id":"da0cea66-8caa-4f73-9e4c-66bb5d8958fd"}}],"variable":[{"id":"5c1fc120-c151-47cf-96f6-325e9e98e855","key":"env","value":"-dev","type":"default"},{"id":"be5265fe-78aa-4eed-8e3a-426e9496dc17","key":"apiKey","value":"eyJvcmciOiI2MGEyMTNjYTcyMTMzZjAwMDFlOWZlODMiLCJpZCI6ImZjOWVmMTViZGVjYzQxNWZhOTMxY2VjYjJlZjI0Y2U2IiwiaCI6Im11cm11cjEyOCJ9","type":"default"},{"id":"be05cdfd-74da-425f-a790-97cb7d29fd0d","key":"cityzenEmail","value":"creation-produit-cityzen@test.mvms","type":"default"},{"id":"015f667f-5327-4590-bc07-f85d4dbb233c","key":"cityzenPassword","value":"Passsword1!","type":"default"},{"id":"f44c9d74-7149-4c75-ab91-65ef168bf0f3","key":"baseUrl","value":"https://stingy-advice-gw.aws-euc1.cloud-ara.tyk.io/","type":"default"},{"id":"00220e1e-fe77-49af-a885-d1cac3635b14","key":"userSignInRoute","value":"user-management-dev/api/v1/users/sign_in","type":"default"},{"id":"58d5a613-39e0-4e88-8c10-49d6ae75512d","key":"createCityzenProductRoute","value":"catalog-dev/api/v1/auth/citizens/self/products","type":"default"},{"id":"ded058f9-524b-46bc-ba9b-484a1fef401a","key":"createUserRoute","value":"user-management-dev/api/v1/users","type":"default"},{"id":"9b68ae0a-53ca-4b7b-b2b5-65cae52b2fa2","key":"deleteProductRoute","value":"catalog-dev/api/v1/auth/products","type":"default"},{"id":"f851b50d-6751-4000-bd4a-4e27df2327db","key":"cityzenProductsRoute","value":"catalog-dev/api/v1/citizens/{{cityzenId}}/products","type":"default"},{"id":"82860a18-e72e-4e48-b997-b6c747da7af1","key":"deleteCityzenRoute","value":"user-management-dev/api/v1/auth/users/self/soft_destroy","type":"default"},{"id":"3b120495-c63d-4e9c-81a0-9f41f1c24caf","key":"getCityzenRoute","value":"user-management-dev/api/v1/auth/users/self/citizen","type":"default"},{"id":"4349f9a5-f32b-487b-83d5-1567574057fe","key":"variantsRoute","value":"catalog-dev/api/v1/auth/variants","type":"default"}]}